<?php
/**
 * –°–∫—Ä–∏–ø—Ç –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∏–∑ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –∏–º—ë–Ω –≤ —Ä—É—Å—Å–∫–∏–µ
 *
 * –í–ê–ñ–ù–û: –ó–∞–ø—É—Å–∫–∞–π –¢–û–õ–¨–ö–û –æ–¥–∏–Ω —Ä–∞–∑, –ø–æ—Ç–æ–º –£–î–ê–õ–ò —ç—Ç–æ—Ç —Ñ–∞–π–ª!
 */

// –ú–∞–ø–ø–∏–Ω–≥ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –∏–º—ë–Ω –≤ —Ä—É—Å—Å–∫–∏–µ –§–ò–û
$name_mapping = array(
    'abramova viktoria' => '–ê–±—Ä–∞–º–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞',
    'alexey abolmasov' => '–ê–±–æ–ª–º–∞—Å–æ–≤ –ê–ª–µ–∫—Å–µ–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á',
    'alexey novak' => '–ù–æ–≤–∞–∫ –ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤–∏—á',
    'anuchina' => '–ê–Ω—É—á–∏–Ω–∞ –°–≤–µ—Ç–ª–∞–Ω–∞ –ë–æ—Ä–∏—Å–æ–≤–Ω–∞',
    'bardina' => '–ë–∞—Ä–¥–∏–Ω–∞ –û–ª—å–≥–∞',
    'borovik' => '–ë–æ—Ä–æ–≤–∏–∫ –ê—Ä—Ç—ë–º –°–µ—Ä–≥–µ–µ–≤–∏—á',
    'chernova galina' => '–ß–µ—Ä–Ω–æ–≤–∞ –ì–∞–ª–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞',
    'dolzhenko ruslan' => '–î–æ–ª–∂–µ–Ω–∫–æ –†—É—Å–ª–∞–Ω –ê–ª–µ–∫—Å–µ–µ–≤–∏—á',
    'fedkina' => '–§–µ–¥—å–∫–∏–Ω–∞ –ò—Ä–∏–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞',
    'kaidalov' => '–ö–∞–π–¥–∞–ª–æ–≤ –õ–µ–≤ –ñ–æ—Ä–∂–µ–≤–∏—á',
    'kidyaeva' => '–ö–∏–¥—è–µ–≤–∞ –ì–∞–ª–∏–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞',
    'konovalova' => '–ö–æ–Ω–æ–≤–∞–ª–æ–≤–∞ –û–ª—å–≥–∞ –°—Ç–∞–Ω–∏—Å–ª–∞–≤–æ–≤–Ω–∞',
    'krivovitsina' => '–ö—Ä–∏–≤–æ–≤–∏—Ü—ã–Ω–∞ –ú–∞—Ä–∏–Ω–∞ –ú–∏—Ö–∞–π–ª–æ–≤–Ω–∞',
    'maxim lebedev' => '–õ–µ–±–µ–¥–µ–≤ –ú–∞–∫—Å–∏–º –ê–Ω–¥—Ä–µ–µ–≤–∏—á',
    'letyaeva' => '–õ–µ—Ç—è–µ–≤–∞ –û–ª—å–≥–∞ –í–∞–ª–µ—Ä—å–µ–≤–Ω–∞',
    'muminov' => '–ú—É–º–∏–Ω–æ–≤ –°—É—Ö—Ä–∞–± –§–∞–π–∑—É–ª–ª–∞–µ–≤–∏—á',
    'seletski' => '–°–µ–ª–µ—Ü–∫–∏–π –≠–¥—É–∞—Ä–¥ –ë–æ—Ä–∏—Å–æ–≤–∏—á',
    'sosnin' => '–°–æ—Å–Ω–∏–Ω –ê–ª–µ–∫—Å–µ–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á',
    'stepan smirnov' => '–°–º–∏—Ä–Ω–æ–≤ –°—Ç–µ–ø–∞–Ω –ê–ª–µ–∫—Å–µ–µ–≤–∏—á',
    'volvatch' => '–í–æ–ª—å–≤–∞—á –ù–∞—Ç–∞–ª—å—è –ò–≥–æ—Ä–µ–≤–Ω–∞'
);

$photos_dir = __DIR__ . '/Photos/';

if (!file_exists($photos_dir)) {
    die("‚ùå –ü–∞–ø–∫–∞ Photos –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!");
}

echo "<!DOCTYPE html><html><head><meta charset='utf-8'><title>–ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</title>";
echo "<style>body { font-family: monospace; padding: 20px; } .success { color: green; } .error { color: red; } .info { color: blue; }</style>";
echo "</head><body>";

echo "<h1>üîÑ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π</h1>";
echo "<hr>";

$renamed_count = 0;
$skipped_count = 0;
$error_count = 0;

// –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —Ñ–∞–π–ª—ã
$files = scandir($photos_dir);

foreach ($files as $file) {
    if ($file === '.' || $file === '..') continue;

    $file_path = $photos_dir . $file;
    if (!is_file($file_path)) continue;

    // –ò–∑–≤–ª–µ–∫–∞–µ–º –∏–º—è –±–µ–∑ –Ω–æ–º–µ—Ä–∞ –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è
    // –ü—Ä–∏–º–µ—Ä: "abramova viktoria1.jpg" ‚Üí "abramova viktoria"
    $name_without_ext = pathinfo($file, PATHINFO_FILENAME);

    // –£–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä –≤ –∫–æ–Ω—Ü–µ (1, 2, 3, –∏ —Ç.–¥.)
    $base_name = preg_replace('/[0-9]+$/', '', $name_without_ext);
    $base_name = trim($base_name);

    // –ò–∑–≤–ª–µ–∫–∞–µ–º –Ω–æ–º–µ—Ä —Ñ–æ—Ç–æ
    preg_match('/([0-9]+)$/', $name_without_ext, $matches);
    $photo_number = isset($matches[1]) ? $matches[1] : '1';

    $ext = pathinfo($file, PATHINFO_EXTENSION);

    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –≤ –º–∞–ø–ø–∏–Ω–≥–µ
    $base_name_lower = mb_strtolower($base_name);

    if (isset($name_mapping[$base_name_lower])) {
        $russian_name = $name_mapping[$base_name_lower];

        // –§–æ—Ä–º–∏—Ä—É–µ–º –Ω–æ–≤–æ–µ –∏–º—è
        if ($photo_number === '1') {
            $new_filename = $russian_name . '.' . $ext;
        } else {
            $new_filename = $russian_name . '-' . $photo_number . '.' . $ext;
        }

        $new_file_path = $photos_dir . $new_filename;

        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —É–∂–µ —Ç–∞–∫–æ–π —Ñ–∞–π–ª
        if (file_exists($new_file_path)) {
            echo "<div class='error'>‚ö†Ô∏è  –ü–†–û–ü–£–©–ï–ù–û: $file ‚Üí $new_filename (—Ñ–∞–π–ª —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç)</div>";
            $skipped_count++;
            continue;
        }

        // –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
        if (rename($file_path, $new_file_path)) {
            echo "<div class='success'>‚úì $file ‚Üí $new_filename</div>";
            $renamed_count++;
        } else {
            echo "<div class='error'>‚ùå –û–®–ò–ë–ö–ê: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å $file</div>";
            $error_count++;
        }
    } else {
        // –ü—Ä–æ–ø—É—Å–∫–∞–µ–º —Ñ–∞–π–ª—ã –∫–æ—Ç–æ—Ä—ã–µ —É–∂–µ —Å —Ä—É—Å—Å–∫–∏–º–∏ –∏–º–µ–Ω–∞–º–∏
        // –∏–ª–∏ –¥–ª—è –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ—Ç –º–∞–ø–ø–∏–Ω–≥–∞
        if (preg_match('/[–∞-—è–ê-–Ø—ë–Å]/u', $file)) {
            // –£–∂–µ —Ä—É—Å—Å–∫–æ–µ –∏–º—è - –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
            continue;
        } else {
            echo "<div class='info'>‚äò –ü–†–û–ü–£–©–ï–ù–û: $file (–Ω–µ –Ω–∞–π–¥–µ–Ω –º–∞–ø–ø–∏–Ω–≥ –¥–ª—è '$base_name_lower')</div>";
            $skipped_count++;
        }
    }
}

echo "<hr>";
echo "<h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:</h2>";
echo "<ul>";
echo "<li class='success'>‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ: $renamed_count</li>";
echo "<li class='info'>‚äò –ü—Ä–æ–ø—É—â–µ–Ω–æ: $skipped_count</li>";
echo "<li class='error'>‚ùå –û—à–∏–±–æ–∫: $error_count</li>";
echo "</ul>";

echo "<hr>";
echo "<h3>üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ:</h3>";
echo "<ol>";
echo "<li>–ó–∞–ø—É—Å—Ç–∏ –∏–º–ø–æ—Ä—Ç —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π –∑–∞–Ω–æ–≤–æ (import-photos.php)</li>";
echo "<li>–¢–µ–ø–µ—Ä—å –¥–æ–ª–∂–Ω–æ –∑–∞–≥—Ä—É–∑–∏—Ç—å—Å—è –≥–æ—Ä–∞–∑–¥–æ –±–æ–ª—å—à–µ —Ñ–æ—Ç–æ!</li>";
echo "<li><strong>–£–î–ê–õ–ò —ç—Ç–æ—Ç —Ñ–∞–π–ª (rename-photos.php) –ø–æ—Å–ª–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è!</strong></li>";
echo "</ol>";

echo "</body></html>";
