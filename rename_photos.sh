#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ—Ç –∞–Ω–≥–ª–∏–π—Å–∫–∏–µ –Ω–∞–∑–≤–∞–Ω–∏—è –≤ —Ä—É—Å—Å–∫–∏–µ –§–ò–û –∏–∑ CSV

cd "$(dirname "$0")"

# Mapping –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö –Ω–∞–∑–≤–∞–Ω–∏–π –≤ —Ä—É—Å—Å–∫–∏–µ –§–ò–û
declare -A NAMES=(
    ["abramova viktoria"]="–ê–±—Ä–∞–º–æ–≤–∞ –í–∏–∫—Ç–æ—Ä–∏—è –í–∏–∫—Ç–æ—Ä–æ–≤–Ω–∞"
    ["alexey abolmasov"]="–ê–±–æ–ª–º–∞—Å–æ–≤ –ê–ª–µ–∫—Å–µ–π –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–∏—á"
    ["alexey novak"]="–ù–æ–≤–∞–∫ –ê–ª–µ–∫—Å–µ–π –ò–≤–∞–Ω–æ–≤–∏—á"
    ["anuchina"]="–ê–Ω—É—á–∏–Ω–∞ –°–≤–µ—Ç–ª–∞–Ω–∞ –ë–æ—Ä–∏—Å–æ–≤–Ω–∞"
    ["bardina"]="–ë–∞—Ä–¥–∏–Ω–∞ –û–ª—å–≥–∞ –†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å"
    ["borovik"]="–ë–æ—Ä–æ–≤–∏–∫ –ê—Ä—Ç—ë–º –°–µ—Ä–≥–µ–µ–≤–∏—á"
    ["chernova galina"]="–ß–µ—Ä–Ω–æ–≤–∞ –ì–∞–ª–∏–Ω–∞ –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–Ω–∞"
    ["dolzhenko ruslan"]="–î–æ–ª–∂–µ–Ω–∫–æ –†—É—Å–ª–∞–Ω –ê–ª–µ–∫—Å–µ–µ–≤–∏—á"
    ["fedkina"]="–§–µ–¥—å–∫–∏–Ω–∞ –ò—Ä–∏–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞"
    ["kaidalov"]="–ö–∞–π–¥–∞–ª–æ–≤ –õ–µ–≤ –ñ–æ—Ä–∂–µ–≤–∏—á"
    ["kidyaeva"]="–ö–∏–¥—è–µ–≤–∞ –ì–∞–ª–∏–Ω–∞ –í–ª–∞–¥–∏–º–∏—Ä–æ–≤–Ω–∞"
    ["konovalova"]="–ö–æ–Ω–æ–≤–∞–ª–æ–≤–∞ –û–ª—å–≥–∞ –°—Ç–∞–Ω–∏—Å–ª–∞–≤–æ–≤–Ω–∞"
    ["krivovitsina"]="–ö—Ä–∏–≤–æ–≤–∏—Ü—ã–Ω–∞ –ú–∞—Ä–∏–Ω–∞ –ú–∏—Ö–∞–π–ª–æ–≤–Ω–∞"
    ["letyaeva"]="–õ–µ—Ç—è–µ–≤–∞ –û–ª—å–≥–∞ –í–∞–ª–µ—Ä—å–µ–≤–Ω–∞"
    ["maxim lebedev"]="–õ–µ–±–µ–¥–µ–≤ –ú–∞–∫—Å–∏–º –ê–Ω–¥—Ä–µ–µ–≤–∏—á"
    ["muminov"]="–ú—É–º–∏–Ω–æ–≤ –°—É—Ö—Ä–∞–± –§–∞–π–∑—É–ª–ª–∞–µ–≤–∏—á"
    ["seletski"]="–°–µ–ª–µ—Ü–∫–∏–π –≠–¥—É–∞—Ä–¥ –ë–æ—Ä–∏—Å–æ–≤–∏—á"
    ["sosnin"]="–°–æ—Å–Ω–∏–Ω –ê–ª–µ–∫—Å–µ–π –ê–ª–µ–∫—Å–∞–Ω–¥—Ä–æ–≤–∏—á"
    ["stepan smirnov"]="–°–º–∏—Ä–Ω–æ–≤ –°—Ç–µ–ø–∞–Ω –ê–ª–µ–∫—Å–µ–µ–≤–∏—á"
    ["volvatch"]="–ù–∞—Ç–∞–ª—å—è –ò–≥–æ—Ä–µ–≤–Ω–∞ –í–æ–ª—å–≤–∞—á"
)

# –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É photos –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
mkdir -p photos

# –°—á–µ—Ç—á–∏–∫
count=0

# –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π
shopt -s nullglob
for file in Photos/*.jpg Photos/*.JPG Photos/*.png Photos/*.PNG; do
    if [ ! -f "$file" ]; then
        continue
    fi

    filename=$(basename "$file")
    # –£–±–∏—Ä–∞–µ–º –Ω–æ–º–µ—Ä –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
    base=$(echo "$filename" | sed 's/[0-9]\+\.jpg$//' | sed 's/[0-9]\+\.JPG$//' | sed 's/[0-9]\+\.png$//' | sed 's/[0-9]\+\.PNG$//')

    # –ü–æ–ª—É—á–∞–µ–º –Ω–æ–º–µ—Ä —Ñ–æ—Ç–æ (1, 2, 3...)
    number=$(echo "$filename" | sed 's/.*\([0-9]\+\)\..*/\1/')

    # –ü–æ–ª—É—á–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
    ext="${filename##*.}"

    # –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–µ —Ä—É—Å—Å–∫–æ–µ –∏–º—è
    russian_name=""
    for key in "${!NAMES[@]}"; do
        if [[ "$base" == "$key" ]]; then
            russian_name="${NAMES[$key]}"
            break
        fi
    done

    if [ -z "$russian_name" ]; then
        echo "‚ö†Ô∏è  –ù–µ –Ω–∞–π–¥–µ–Ω–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è: $filename"
        continue
    fi

    # –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º
    if [ "$number" == "1" ]; then
        # –ü–µ—Ä–≤–∞—è —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏—è - –≥–ª–∞–≤–Ω–∞—è (–±–µ–∑ –Ω–æ–º–µ—Ä–∞)
        new_name="photos/${russian_name}.${ext}"
    else
        # –û—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ - –¥–ª—è –≥–∞–ª–µ—Ä–µ–∏ (—Å –Ω–æ–º–µ—Ä–æ–º)
        new_name="photos/${russian_name}-${number}.${ext}"
    fi

    cp "$file" "$new_name"
    echo "‚úÖ $filename ‚Üí $(basename "$new_name")"
    ((count++))
done

echo ""
echo "üìä –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–π: $count"
echo "üìÅ –í—Å–µ —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –Ω–∞—Ö–æ–¥—è—Ç—Å—è –≤ –ø–∞–ø–∫–µ: photos/"
echo ""
echo "üéØ –ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –∏–º–ø–æ—Ä—Ç CSV"
